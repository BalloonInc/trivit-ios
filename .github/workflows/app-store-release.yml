name: App Store Release

# Uses shared workflow from ios-infra for App Store release preparation

on:
  workflow_dispatch:
    inputs:
      app_version:
        description: 'App version (e.g., 1.0.0)'
        required: true
        default: '1.0.0'
        type: string
      build_number:
        description: 'Build number to release (from TestFlight)'
        required: true
        type: string
      generate_screenshots:
        description: 'Generate new screenshots'
        required: false
        default: true
        type: boolean
      generate_description:
        description: 'Generate description with AI'
        required: false
        default: true
        type: boolean
      submit_for_review:
        description: 'Submit to App Store review'
        required: false
        default: false
        type: boolean

concurrency:
  group: app-store-release
  cancel-in-progress: false

jobs:
  release:
    uses: wdvr/ios-infra/.github/workflows/ios-app-store-release.yml@main
    with:
      bundle_id: com.wouterdevriendt.trivit
      scheme: TrivitUITests
      app_version: ${{ github.event.inputs.app_version }}
      build_number: ${{ github.event.inputs.build_number }}
      app_name: Trivit
      app_context: 'A beautiful tally counter app for iOS with colorful design, haptic feedback, and Apple Watch support'
      generate_screenshots: ${{ github.event.inputs.generate_screenshots }}
      generate_description: ${{ github.event.inputs.generate_description }}
      submit_for_review: ${{ github.event.inputs.submit_for_review }}
    secrets: inherit
