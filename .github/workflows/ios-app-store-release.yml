name: App Store Release

# Fully automated App Store release with AI-generated release notes
# Uses shared workflow from ios-infra

on:
  workflow_dispatch:
    inputs:
      app_version:
        description: 'Marketing version (e.g., 1.0.0)'
        required: true
        type: string
      build_number:
        description: 'Build number to release'
        required: true
        type: string
      generate_screenshots:
        description: 'Generate new screenshots'
        required: false
        type: boolean
        default: true
      generate_description:
        description: 'AI-generate description'
        required: false
        type: boolean
        default: true
      generate_release_notes:
        description: 'Generate release notes with AI (from commits since last release)'
        required: false
        type: boolean
        default: true
      submit_for_review:
        description: 'Submit to App Store review'
        required: false
        type: boolean
        default: true

permissions:
  actions: read
  contents: write

jobs:
  release:
    uses: wdvr/ios-infra/.github/workflows/ios-app-store-release.yml@main
    with:
      bundle_id: com.wouterdevriendt.trivit
      scheme: trivit
      app_name: 'Trivit'
      app_context: 'Trivit is a tally counter app that helps users count anything - perfect for counting inventory, tracking habits, or keeping score. Features colorful tally marks, statistics, and Apple Watch support.'
      app_version: ${{ inputs.app_version }}
      build_number: ${{ inputs.build_number }}
      generate_screenshots: ${{ inputs.generate_screenshots }}
      generate_description: ${{ inputs.generate_description }}
      generate_release_notes: ${{ inputs.generate_release_notes }}
      submit_for_review: ${{ inputs.submit_for_review }}
    secrets:
      APP_STORE_CONNECT_KEY_ID: ${{ secrets.APP_STORE_CONNECT_KEY_ID }}
      APP_STORE_CONNECT_ISSUER_ID: ${{ secrets.APP_STORE_CONNECT_ISSUER_ID }}
      APP_STORE_CONNECT_PRIVATE_KEY: ${{ secrets.APP_STORE_CONNECT_PRIVATE_KEY }}
      ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
