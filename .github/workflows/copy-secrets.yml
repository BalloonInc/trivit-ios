name: "Copy Secrets from Footprint"

# One-time workflow to copy required secrets from wdvr/footprint repo

on:
  workflow_dispatch:

permissions:
  contents: read

jobs:
  copy-secrets:
    name: Copy Apple Developer Secrets
    runs-on: ubuntu-latest

    steps:
    - name: Copy APP_STORE_CONNECT_PRIVATE_KEY
      env:
        SOURCE_SECRET: ${{ secrets.APP_STORE_CONNECT_PRIVATE_KEY }}
        GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: |
        if [ -z "$SOURCE_SECRET" ]; then
          echo "❌ APP_STORE_CONNECT_PRIVATE_KEY not available in current repo"
          echo "This secret needs to be manually copied from wdvr/footprint"
          exit 1
        else
          echo "✅ APP_STORE_CONNECT_PRIVATE_KEY is available"
        fi

    - name: Instructions
      run: |
        echo "## Secret Copy Instructions" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "To complete the setup, manually copy these secrets from **wdvr/footprint**:" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "1. **APP_STORE_CONNECT_PRIVATE_KEY** - Apple Developer API private key" >> $GITHUB_STEP_SUMMARY
        echo "2. **DISTRIBUTION_CERTIFICATE_BASE64** - iOS distribution certificate" >> $GITHUB_STEP_SUMMARY
        echo "3. **DISTRIBUTION_CERTIFICATE_PASSWORD** - Certificate password" >> $GITHUB_STEP_SUMMARY
        echo "4. **KEYCHAIN_PASSWORD** - Keychain password for CI" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### Commands to run:" >> $GITHUB_STEP_SUMMARY
        echo '```bash' >> $GITHUB_STEP_SUMMARY
        echo 'gh secret set APP_STORE_CONNECT_PRIVATE_KEY --body "$(gh secret get APP_STORE_CONNECT_PRIVATE_KEY --repo wdvr/footprint)" --repo BalloonInc/trivit-ios' >> $GITHUB_STEP_SUMMARY
        echo '```' >> $GITHUB_STEP_SUMMARY